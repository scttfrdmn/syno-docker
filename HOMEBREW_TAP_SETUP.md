# syno-docker Homebrew Tap Setup Guide

This guide walks through creating and configuring the Homebrew tap for syno-docker distribution.

## ğŸ—ï¸ **Repository Setup**

### 1. Create Homebrew Tap Repository

```bash
# Create repository on GitHub: scttfrdmn/homebrew-tap
# Repository must be named with 'homebrew-' prefix
```

**Repository Settings:**
- **Name**: `homebrew-tap`
- **Description**: "Homebrew formulae for syno-docker and other tools"
- **Visibility**: Public (required for Homebrew taps)
- **Initialize**: Empty repository (Goreleaser will create the structure)

### 2. GitHub Personal Access Token

Create a Personal Access Token with permissions:
- âœ… `repo` (full repository access)
- âœ… `write:packages` (for GitHub Packages)
- âœ… `delete:packages` (for package management)

**Add to GitHub Secrets:**
```bash
# In scttfrdmn/syno-docker repository settings â†’ Secrets and variables â†’ Actions
Name: HOMEBREW_TAP_GITHUB_TOKEN
Value: <your-personal-access-token>
```

## ğŸ“ **Expected Tap Structure**

After first release, the tap repository will contain:

```
homebrew-tap/
â”œâ”€â”€ Formula/
â”‚   â””â”€â”€ syno-docker.rb       # Auto-generated by Goreleaser
â”œâ”€â”€ README.md               # Manual: tap documentation
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ tests.yml       # Optional: tap testing
â””â”€â”€ .gitignore              # Optional: ignore patterns
```

## ğŸš€ **Deployment Process**

### 1. Push syno-docker Repository
```bash
# Add remote origin
git remote add origin https://github.com/scttfrdmn/syno-docker.git

# Push main branch and tags
git push origin main --tags

# This triggers GitHub Actions â†’ Goreleaser â†’ Homebrew tap update
```

### 2. Goreleaser Automation
When you push a git tag:
1. **GitHub Actions** runs the release workflow
2. **Goreleaser** builds cross-platform binaries
3. **GitHub Release** is created with assets
4. **Homebrew Formula** is auto-generated and committed to tap repo
5. **Users can install** with `brew install scttfrdmn/tap/syno-docker`

## ğŸ“‹ **Generated Formula Preview**

Goreleaser will create `Formula/syno-docker.rb`:

```ruby
class Synodeploy < Formula
  desc "Deploy containers to Synology DSM 7.2+ with ease"
  homepage "https://github.com/scttfrdmn/syno-docker"
  version "0.1.1"
  license "MIT"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/scttfrdmn/syno-docker/releases/download/v0.1.1/syno-docker-Darwin-x86_64.tar.gz"
      sha256 "auto-calculated-checksum"
    end
    if Hardware::CPU.arm?
      url "https://github.com/scttfrdmn/syno-docker/releases/download/v0.1.1/syno-docker-Darwin-arm64.tar.gz"
      sha256 "auto-calculated-checksum"
    end
  end

  on_linux do
    if Hardware::CPU.intel?
      url "https://github.com/scttfrdmn/syno-docker/releases/download/v0.1.1/syno-docker-Linux-x86_64.tar.gz"
      sha256 "auto-calculated-checksum"
    end
    if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
      url "https://github.com/scttfrdmn/syno-docker/releases/download/v0.1.1/syno-docker-Linux-arm64.tar.gz"
      sha256 "auto-calculated-checksum"
    end
  end

  def install
    bin.install "syno-docker"
    generate_completions_from_executable(bin/"syno-docker", "completion")
  end

  test do
    system "#{bin}/syno-docker", "--version"
    system "#{bin}/syno-docker", "--help"
    output = shell_output("#{bin}/syno-docker init --help")
    assert_match "Setup connection to Synology NAS", output
  end
end
```

## ğŸ‘¥ **User Installation Process**

After tap is live:

```bash
# Add the tap
brew tap scttfrdmn/tap

# Install syno-docker
brew install syno-docker

# Verify installation
syno-docker --version

# Use immediately
syno-docker init your-nas.local --user your-username
```

## ğŸ”„ **Continuous Updates**

### Automatic Updates
- **New Releases**: Push git tags â†’ automatic formula updates
- **Version Bumps**: Goreleaser handles version and checksum updates
- **Cross-platform**: All architectures updated simultaneously

### Manual Tap Management
```bash
# Clone tap repository for manual updates if needed
git clone https://github.com/scttfrdmn/homebrew-tap.git
cd homebrew-tap

# Make manual changes to Formula/syno-docker.rb if needed
# Commit and push changes
```

## âœ… **Ready to Deploy Checklist**

- âœ… **Goreleaser Config**: Updated with modern best practices
- âœ… **GitHub Actions**: Release workflow configured
- âœ… **Binary Builds**: Cross-platform compilation working
- âœ… **Shell Completions**: Auto-generation configured
- âœ… **Test Block**: Proper formula testing included
- âœ… **License**: MIT license properly declared
- âœ… **Integration Tests**: Verified working on real hardware

## ğŸ¯ **Next Steps**

1. **Create `homebrew-tap` repository** on GitHub
2. **Add GitHub token** to syno-docker repository secrets
3. **Push syno-docker code** to GitHub with tags
4. **Users can install** with `brew install scttfrdmn/tap/syno-docker`

The entire automation pipeline is configured and ready for deployment!

## ğŸ” **Verification Commands**

After tap creation, verify with:
```bash
# Test tap installation locally
brew tap scttfrdmn/tap
brew install syno-docker

# Test functionality
syno-docker --version
syno-docker init --help

# Test on your system
syno-docker init chubchub.local --user scttfrdmn
syno-docker run hello-world --name test
syno-docker ps
syno-docker rm test --force
```